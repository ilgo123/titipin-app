import{c as R,u as A,a as P,r,s as j,j as e,A as B,L as I,n as x}from"./index-ClXmW7HF.js";import{S as D,C as L}from"./ConfirmModal-C5_-M_JW.js";import{C as E}from"./chevron-left-DLbePdLL.js";import{R as K,T as y,S as F}from"./truck-gIrrtkXf.js";import{P as v}from"./package-D4vBBs2Z.js";import{P as O}from"./plus-CFTPUeQ9.js";import{T as J}from"./trash-2-KhomIK7G.js";import{C as N}from"./clock-BXtSfbHO.js";import{C as Y}from"./circle-check-D5qtfpr7.js";const G=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],U=R("circle-alert",G);function ae(){const c=A(),{user:n,checkSession:k}=P(),[m,u]=r.useState(!0),[t,p]=r.useState("requests"),[b,g]=r.useState(null),[f,w]=r.useState([]),[h,C]=r.useState([]);r.useEffect(()=>{o()},[]);const o=async()=>{u(!0);const{data:s,error:a}=await j.from("orders").select("*, requester:requester_id(full_name, avatar_url), traveler:traveler_id(full_name, avatar_url)").or(`requester_id.eq.${n.id},traveler_id.eq.${n.id}`).order("created_at",{ascending:!1});a||(w(s.filter(l=>l.requester_id===n.id)),C(s.filter(l=>l.traveler_id===n.id))),u(!1)},q=(s,a)=>{s.stopPropagation(),$(a),d(!0)},_=async()=>{if(!i)return;d(!1);const s=x.loading("Membatalkan pesanan...");g(i.id);try{const{error:a}=await j.rpc("cancel_order_refund",{p_order_id:i.id,p_user_id:n.id});if(a)throw a;x.success("Pesanan dibatalkan. Saldo kembali! ðŸ’°",{id:s}),await k(),o()}catch(a){x.error("Gagal: "+a.message,{id:s})}finally{g(null)}},S=s=>{switch(s){case"open":return{color:"bg-gray-100 text-gray-500",icon:e.jsx(N,{size:14}),label:"Menunggu Traveler"};case"taken":return{color:"bg-blue-50 text-blue-600",icon:e.jsx(v,{size:14}),label:"Diproses"};case"bought":return{color:"bg-purple-50 text-purple-600",icon:e.jsx(F,{size:14}),label:"Sudah Dibeli"};case"otw":return{color:"bg-orange-50 text-orange-600",icon:e.jsx(y,{size:14}),label:"Sedang Diantar"};case"done":return{color:"bg-green-50 text-green-600",icon:e.jsx(Y,{size:14}),label:"Selesai"};case"cancelled":return{color:"bg-red-50 text-red-500",icon:e.jsx(U,{size:14}),label:"Dibatalkan"};default:return{color:"bg-gray-100 text-gray-500",icon:e.jsx(N,{size:14}),label:s}}},z=s=>new Intl.NumberFormat("id-ID").format(s),[T,d]=r.useState(!1),[i,$]=r.useState(null);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsxs("div",{className:"bg-white sticky top-0 z-20 shadow-sm pt-6 pb-0",children:[e.jsxs("div",{className:"px-6 flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>c("/"),className:"flex items-center gap-1 text-sm font-bold text-gray-400 mb-1 hover:text-slate-900 transition-colors",children:[e.jsx(E,{size:18})," Kembali"]}),e.jsx("h1",{className:"text-2xl font-black text-slate-900",children:"Aktivitas ðŸ“¦"})]}),e.jsx("button",{onClick:o,className:"p-2 bg-gray-100 rounded-full hover:bg-gray-200 active:scale-90 transition-all text-slate-600",children:e.jsx(K,{size:20,className:m?"animate-spin":""})})]}),e.jsxs("div",{className:"flex px-6 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>p("requests"),className:`flex-1 pb-4 text-sm font-bold transition-all border-b-2 ${t==="requests"?"border-slate-900 text-slate-900":"border-transparent text-gray-400 hover:text-gray-600"}`,children:"Titipan Saya"}),e.jsx("button",{onClick:()=>p("jobs"),className:`flex-1 pb-4 text-sm font-bold transition-all border-b-2 ${t==="jobs"?"border-slate-900 text-slate-900":"border-transparent text-gray-400 hover:text-gray-600"}`,children:"Pekerjaan"})]})]}),e.jsx("div",{className:"p-6 space-y-4",children:m?[1,2].map(s=>e.jsx(D,{className:"h-32 w-full rounded-3xl"},s)):e.jsx(e.Fragment,{children:(t==="requests"?f:h).length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-center opacity-60",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4 text-gray-400",children:t==="requests"?e.jsx(v,{size:32}):e.jsx(y,{size:32})}),e.jsx("h3",{className:"font-bold text-gray-600 text-lg",children:"Kosong Melompong"}),e.jsx("p",{className:"text-xs text-gray-400 max-w-[200px] mb-6",children:t==="requests"?"Belum ada titipan aktif.":"Belum ada pekerjaan diambil."}),e.jsx("button",{onClick:()=>c(t==="requests"?"/penitip":"/traveler"),className:"bg-slate-900 text-white px-6 py-3 rounded-xl font-bold text-sm shadow-lg flex items-center gap-2",children:t==="requests"?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:18})," Buat Titipan"]}):"Cari Cuan"})]}):(t==="requests"?f:h).map(s=>{const a=S(s.status),l=t==="requests"?s.traveler:s.requester;return e.jsxs("div",{onClick:()=>s.status!=="cancelled"&&c(`/order-detail/${s.id}`),className:`bg-white p-5 rounded-[1.5rem] shadow-sm border border-slate-100 relative overflow-hidden group transition-all ${s.status==="cancelled"?"opacity-60 grayscale":"hover:shadow-md cursor-pointer"}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h3",{className:`font-bold text-lg line-clamp-1 ${s.status==="cancelled"?"text-gray-400 line-through":"text-slate-900"}`,children:s.item}),e.jsxs("div",{className:`flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[10px] font-bold uppercase tracking-wide ${a.color}`,children:[a.icon," ",a.label]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx("span",{className:"text-[10px] bg-gray-100 px-1.5 py-0.5 rounded font-bold",children:"DARI"}),e.jsx("span",{className:"font-medium truncate max-w-[80px]",children:s.from_location})]}),e.jsx(B,{size:14,className:"opacity-30 shrink-0"}),e.jsxs("div",{className:"flex items-center gap-1 min-w-0",children:[e.jsx("span",{className:"text-[10px] bg-gray-100 px-1.5 py-0.5 rounded font-bold",children:"KE"}),e.jsx("span",{className:"font-medium truncate max-w-[80px]",children:s.to_location})]})]}),e.jsx("div",{className:"h-px bg-gray-100 w-full mb-3"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-200 overflow-hidden",children:l?e.jsx("img",{src:l.avatar_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-slate-300"})}),e.jsx("span",{className:"text-xs font-bold text-gray-500",children:l?l.full_name.split(" ")[0]:"..."})]}),t==="requests"&&s.status==="open"?e.jsxs("button",{onClick:M=>q(M,s),disabled:b===s.id,className:"flex items-center gap-1 text-red-500 bg-red-50 px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-red-100 transition-colors z-20",children:[b===s.id?e.jsx(I,{size:12,className:"animate-spin"}):e.jsx(J,{size:12}),"Batalkan"]}):e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase",children:t==="requests"?"Total":"Komisi"}),e.jsxs("p",{className:`text-sm font-black ${t==="requests"?"text-slate-800":"text-green-600"}`,children:["Rp ",z(t==="requests"?s.price+s.tip:s.tip)]})]}),e.jsx(L,{isOpen:T,onClose:()=>d(!1),onConfirm:_,title:"Batalkan Pesanan?",message:`Yakin batalkan "${i?.item}"? Saldo akan dikembalikan ke dompetmu.`,confirmText:"Ya, Batalkan"})]})]},s.id)})})})]})}export{ae as default};
