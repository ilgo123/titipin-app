import{c as g,u as E,a as K,r as s,s as S,j as e,X as B,A as M,n as f}from"./index-ClXmW7HF.js";import{S as X,C as G}from"./ConfirmModal-C5_-M_JW.js";import{C as U}from"./chevron-left-DLbePdLL.js";import{C as J}from"./clock-BXtSfbHO.js";import{P as Q}from"./package-D4vBBs2Z.js";import{M as _}from"./map-pin-IFDHxthE.js";const V=[["path",{d:"M12.531 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14v6a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341l.427-.473",key:"ol2ft2"}],["path",{d:"m16.5 3.5 5 5",key:"15e6fa"}],["path",{d:"m21.5 3.5-5 5",key:"m0lwru"}]],W=g("funnel-x",V);const Y=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Z=g("search",Y);const ee=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],te=g("sliders-horizontal",ee);function ce(){const b=E(),{user:d}=K(),[j,C]=s.useState([]),[q,y]=s.useState(!0),[o,v]=s.useState(""),[i,T]=s.useState(""),[u,z]=s.useState(!1),[a,N]=s.useState(""),[r,k]=s.useState(""),[I,O]=s.useState([]),[$,F]=s.useState([]),[A,p]=s.useState(!1),[h,D]=s.useState(null);s.useEffect(()=>{const t=setTimeout(()=>T(o),500);return()=>clearTimeout(t)},[o]),s.useEffect(()=>{d&&L()},[d,i,a,r]);const L=async()=>{y(!0);let t=S.from("orders").select("*, requester:requester_id(full_name, avatar_url, rating)").eq("status","open").neq("requester_id",d.id).order("created_at",{ascending:!1});i&&(t=t.or(`item.ilike.%${i}%,from_location.ilike.%${i}%,to_location.ilike.%${i}%`)),a&&(t=t.eq("from_location",a)),r&&(t=t.eq("to_location",r));const{data:l,error:m}=await t;if(m)console.error(m);else if(C(l||[]),!i&&!a&&!r){const x=[...new Set(l.map(n=>n.from_location))],c=[...new Set(l.map(n=>n.to_location))];O(x),F(c)}y(!1)},w=t=>new Intl.NumberFormat("id-ID").format(t),H=t=>{const l=new Date,m=new Date(t),x=Math.floor((l-m)/1e3);if(x<60)return"Baru saja";const c=Math.floor(x/60);if(c<60)return`${c} menit lalu`;const n=Math.floor(c/60);return n<24?`${n} jam lalu`:`${Math.floor(n/24)} hari lalu`},P=t=>{D(t),p(!0)},R=async()=>{if(!h)return;const t=f.loading("Memproses..."),{error:l}=await S.from("orders").update({status:"taken",traveler_id:d.id}).eq("id",h);l?f.error("Gagal: "+l.message,{id:t}):(f.success("Berhasil diambil!",{id:t}),p(!1),setTimeout(()=>b("/chat",{state:{orderId:h}}),1e3))};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsxs("div",{className:"bg-white sticky top-0 z-20 px-6 pt-6 pb-4 shadow-sm rounded-b-[2rem]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>b("/"),className:"p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(U,{size:24,className:"text-slate-900"})}),e.jsx("h1",{className:"text-xl font-black text-slate-900",children:"Cari Cuan ðŸ’°"})]}),e.jsxs("button",{onClick:()=>z(!u),className:`p-2.5 rounded-xl transition-all relative ${u||a||r?"bg-slate-900 text-white":"bg-gray-100 text-slate-500"}`,children:[e.jsx(te,{size:20}),(a||r)&&e.jsx("div",{className:"absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full border-2 border-white"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute left-4 top-3.5 text-gray-400 group-focus-within:text-slate-900 transition-colors",children:e.jsx(Z,{size:20})}),e.jsx("input",{type:"text",value:o,onChange:t=>v(t.target.value),placeholder:"Cari barang (cth: Lumpia)",className:"w-full bg-gray-100 border border-transparent text-slate-900 font-medium rounded-2xl pl-12 pr-10 py-3 outline-none focus:bg-white focus:border-slate-900 focus:ring-4 focus:ring-slate-100 transition-all placeholder:text-gray-400"}),o&&e.jsx("button",{onClick:()=>v(""),className:"absolute right-4 top-3.5 text-gray-400 hover:text-red-500",children:e.jsx(B,{size:18})})]}),u&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100 grid grid-cols-2 gap-3 animate-in slide-in-from-top-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Dari Kota"}),e.jsxs("select",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl p-2 text-sm font-bold text-slate-900 outline-none",value:a,onChange:t=>N(t.target.value),children:[e.jsx("option",{value:"",children:"Semua"}),I.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase ml-1",children:"Ke Kota"}),e.jsxs("select",{className:"w-full bg-gray-50 border border-gray-200 rounded-xl p-2 text-sm font-bold text-slate-900 outline-none",value:r,onChange:t=>k(t.target.value),children:[e.jsx("option",{value:"",children:"Semua"}),$.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),(a||r)&&e.jsx("button",{onClick:()=>{N(""),k("")},className:"col-span-2 text-xs font-bold text-red-500 py-1",children:"Reset Filter Lokasi"})]})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[q?[1,2,3].map(t=>e.jsx(X,{className:"h-48 w-full rounded-[2rem]"},t)):j.length===0?e.jsxs("div",{className:"text-center py-20 opacity-50 flex flex-col items-center",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mb-4 text-gray-400",children:e.jsx(W,{size:32})}),e.jsx("h3",{className:"font-bold text-gray-600 text-lg",children:"Tidak ditemukan"}),e.jsx("p",{className:"text-xs text-gray-400 max-w-[200px]",children:o?`Tidak ada orderan yang cocok dengan "${o}"`:"Belum ada titipan tersedia saat ini."})]}):j.map(t=>e.jsxs("div",{className:"bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100 hover:shadow-md transition-shadow relative overflow-hidden group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden border border-white shadow-sm",children:e.jsx("img",{src:t.requester?.avatar_url,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 text-sm",children:t.requester?.full_name}),e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-gray-500 font-medium",children:[e.jsxs("span",{className:"flex items-center gap-1",children:["â˜… ",t.requester?.rating?t.requester.rating.toFixed(1):"New"]}),e.jsx("span",{className:"w-1 h-1 bg-gray-300 rounded-full"}),e.jsxs("span",{className:"flex items-center gap-1 text-slate-400",children:[e.jsx(J,{size:10})," ",H(t.created_at)]})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase",children:"Komisi"}),e.jsxs("p",{className:"text-lg font-black text-green-600",children:["+Rp ",w(t.tip)]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Q,{size:18,className:"text-blue-600"}),e.jsx("h3",{className:"font-bold text-lg text-slate-800 line-clamp-1",children:t.item})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 text-xs font-medium text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-lg border border-gray-100",children:[e.jsx(_,{size:12})," ",t.from_location]}),e.jsx(M,{size:12,className:"opacity-30"}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-50 px-2 py-1 rounded-lg border border-gray-100",children:[e.jsx(_,{size:12})," ",t.to_location]})]})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-50 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] text-gray-400 font-bold uppercase",children:"Modal Talangan"}),e.jsxs("p",{className:"text-xs font-bold text-slate-700",children:["Rp ",w(t.price)]})]}),e.jsxs("button",{onClick:()=>P(t.id),className:"bg-slate-900 text-white px-5 py-2.5 rounded-xl font-bold text-xs shadow-lg shadow-slate-200 hover:bg-slate-800 active:scale-95 transition-all flex items-center gap-2",children:["Ambil Order ",e.jsx(M,{size:14})]})]})]},t.id)),e.jsx(G,{isOpen:A,onClose:()=>p(!1),onConfirm:R,title:"Ambil Pesanan Ini?",message:"Pastikan kamu memiliki modal yang cukup untuk menalangi barang ini. Pembatalan sepihak akan mengurangi reputasimu.",confirmText:"Siap, Ambil!"})]})]})}export{ce as default};
